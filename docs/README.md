# ?? Crypto Payment Integration - Frontend Documentation

Complete integration guide for implementing cryptocurrency payments in the Wihngo Expo React Native mobile application.

---

## ?? Documentation Files

This folder contains all the resources your frontend team needs to integrate crypto payments:

### ?? Quick Start
- **[FRONTEND_QUICK_START.md](./FRONTEND_QUICK_START.md)** - TL;DR version with minimal code examples

### ?? Complete Guide
- **[CRYPTO_PAYMENT_FRONTEND_INTEGRATION.md](./CRYPTO_PAYMENT_FRONTEND_INTEGRATION.md)** - Full integration documentation with detailed examples

### ?? Code Resources
- **[typescript-types.ts](./typescript-types.ts)** - Complete TypeScript type definitions
- **[Wihngo_Crypto_Payments_API.postman_collection.json](./Wihngo_Crypto_Payments_API.postman_collection.json)** - Postman collection for API testing

---

## ?? Getting Started

### For GitHub Copilot

If you're using GitHub Copilot to implement the frontend, provide this prompt:

```
I need to implement crypto payment functionality in an Expo React Native app. 

Context:
- Read the complete guide: docs/CRYPTO_PAYMENT_FRONTEND_INTEGRATION.md
- Use the TypeScript types from: docs/typescript-types.ts
- API base URL: https://api.wihngo.com/api/payments/crypto

Requirements:
1. Support USDT on Tron (TRC-20), Ethereum (ERC-20), and BSC (BEP-20)
2. IMPORTANT: BSC uses 18 decimals, not 6!
3. Create payment screen with QR code and manual address input
4. Implement transaction hash submission
5. Add status polling (every 5 seconds)
6. Show confirmation progress (X/Y confirmations)
7. Handle payment expiration (30 minutes)
8. Show payment history

Use the code examples and component structure from the documentation.
```

### For Developers

1. **Read Quick Start First**: [FRONTEND_QUICK_START.md](./FRONTEND_QUICK_START.md)
2. **Test API with Postman**: Import [Wihngo_Crypto_Payments_API.postman_collection.json](./Wihngo_Crypto_Payments_API.postman_collection.json)
3. **Copy TypeScript Types**: Copy [typescript-types.ts](./typescript-types.ts) to your project
4. **Implement Payment Flow**: Follow the complete guide

---

## ?? Key Features to Implement

### ? Must Have (MVP)
- [ ] Network selection (Tron, Ethereum, BSC)
- [ ] Create payment request
- [ ] Display QR code with wallet address
- [ ] Copy address to clipboard
- [ ] Transaction hash input
- [ ] Submit and verify payment
- [ ] Status polling
- [ ] Confirmation progress display
- [ ] Payment completion notification
- [ ] 30-minute expiration timer

### ?? Nice to Have
- [ ] Payment history screen
- [ ] Deep linking from wallet apps
- [ ] Payment cancellation
- [ ] Network fee comparison
- [ ] Exchange rate display
- [ ] Block explorer links
- [ ] Help/FAQ section
- [ ] Push notifications for status updates

---

## ??? Project Structure

Recommended folder structure for your implementation:

```
src/
??? services/
?   ??? cryptoPaymentApi.ts          # API client
??? hooks/
?   ??? useCryptoPayment.ts          # Payment logic hook
?   ??? usePaymentTimer.ts           # Timer countdown hook
??? screens/
?   ??? CryptoPaymentScreen.tsx      # Main payment screen
?   ??? PaymentHistoryScreen.tsx    # Payment history
?   ??? PaymentSuccessScreen.tsx    # Success screen
??? components/
?   ??? NetworkSelector.tsx          # Network selection component
?   ??? PaymentQRCode.tsx            # QR code display
?   ??? TransactionHashInput.tsx    # TX hash input
?   ??? PaymentStatus.tsx            # Status badge
?   ??? ConfirmationProgress.tsx    # Progress indicator
??? types/
?   ??? cryptoPayment.ts             # TypeScript definitions
??? utils/
    ??? formatCrypto.ts              # Format crypto amounts
    ??? validateTxHash.ts            # Validate transaction hashes
```

---

## ?? Supported Networks

| Network | Token | Decimals | Confirmations | Avg Time | Fee |
|---------|-------|----------|---------------|----------|-----|
| **Tron** | TRC-20 | 6 | 19 | ~57s | Low |
| **Ethereum** | ERC-20 | 6 | 12 | ~2.4min | High |
| **BSC** | BEP-20 | **18** ?? | 15 | ~45s | Medium |

**?? CRITICAL:** BSC uses **18 decimals**, not 6 like Tron and Ethereum!

---

## ?? API Endpoints Summary

```
Base URL: https://api.wihngo.com/api/payments/crypto

Public (No Auth):
?? GET  /rates                        # All exchange rates
?? GET  /rates/{currency}             # Specific rate
?? GET  /wallet/{currency}/{network}  # Platform wallet

Authenticated (Bearer Token):
?? POST /create                       # Create payment
?? POST /{id}/verify                  # Verify with tx hash
?? GET  /{id}                         # Get status (auto-check)
?? POST /{id}/check-status            # Force check status
?? GET  /history                      # Payment history
?? POST /{id}/cancel                  # Cancel payment
```

---

## ?? Payment Flow Diagram

```
???????????????????????????????????????????????????????????????
?                     USER INITIATES PAYMENT                   ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  1. Select Network (Tron/Ethereum/BSC)                       ?
?  2. POST /create ? Get payment details                       ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  DISPLAY PAYMENT SCREEN                                      ?
?  ?? Amount: X.XXXXXX USDT                                   ?
?  ?? QR Code                                                  ?
?  ?? Wallet Address + Copy Button                            ?
?  ?? Timer: 29:45 remaining                                  ?
?  ?? Instructions                                             ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  USER SENDS CRYPTO FROM WALLET                               ?
?  (Opens Trust Wallet, MetaMask, TronLink, etc.)             ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  USER SUBMITS TRANSACTION HASH                               ?
?  POST /{id}/verify                                           ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  BACKEND VERIFIES ON BLOCKCHAIN                              ?
?  ?? Checks transaction exists                                ?
?  ?? Validates amount                                         ?
?  ?? Validates recipient address                             ?
?  ?? Returns status: confirming                               ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  START POLLING (Every 5 seconds)                             ?
?  GET /{id} or POST /{id}/check-status                        ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  SHOW CONFIRMATION PROGRESS                                  ?
?  Status: confirming                                          ?
?  Confirmations: 8/19 ?????????????????                      ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?  PAYMENT CONFIRMED                                           ?
?  Status: confirmed ? completed                               ?
?  Premium activated! ?                                       ?
???????????????????????????????????????????????????????????????
```

---

## ?? Common Pitfalls to Avoid

### 1. Wrong Decimal Places
```javascript
// ? DON'T: Use hardcoded decimals
const amount = wei / 1_000_000;

// ? DO: Use network-specific decimals
const decimals = network === 'binance-smart-chain' ? 18 : 6;
const amount = wei / Math.pow(10, decimals);
```

### 2. Not Handling Expiration
```javascript
// ? DON'T: Ignore expiration
// User might try to pay after 30 minutes

// ? DO: Check expiration and show warning
if (new Date() > new Date(payment.expiresAt)) {
  showError("Payment expired. Please create a new one.");
}
```

### 3. Insufficient Polling
```javascript
// ? DON'T: Only verify once
await verifyPayment(id, txHash);

// ? DO: Poll until completed
const interval = setInterval(async () => {
  const status = await checkStatus(id);
  if (status.status === 'completed') {
    clearInterval(interval);
    showSuccess();
  }
}, 5000);
```

### 4. Not Validating Transaction Hash
```javascript
// ? DON'T: Submit without validation
await verifyPayment(id, userInput);

// ? DO: Validate format first
if (!/^0x[a-fA-F0-9]{64}$/.test(txHash)) {
  showError("Invalid transaction hash format");
  return;
}
```

---

## ?? Testing Checklist

Before submitting to production:

### Functional Testing
- [ ] Create payment on each network (Tron, Ethereum, BSC)
- [ ] QR code displays correctly
- [ ] Address copy works
- [ ] Timer counts down
- [ ] Submit valid transaction hash
- [ ] Submit invalid transaction hash
- [ ] Polling works correctly
- [ ] Status updates in real-time
- [ ] Payment completion shows success
- [ ] Expiration handled correctly
- [ ] Cancel payment works

### Edge Cases
- [ ] Network timeout during API call
- [ ] App backgrounded during payment
- [ ] Authentication token expires
- [ ] Minimum amount validation ($5)
- [ ] Maximum amount handling
- [ ] Duplicate transaction hash submission
- [ ] User sends wrong amount
- [ ] User sends to wrong address

### UX Testing
- [ ] Loading states show properly
- [ ] Error messages are clear
- [ ] Success animation/feedback
- [ ] Network selection is intuitive
- [ ] Instructions are helpful
- [ ] Back button handling
- [ ] Deep linking from wallet works

---

## ?? Troubleshooting

### "Payment not found"
- Check if paymentId is correct
- Verify user authentication
- Ensure payment belongs to current user

### "Transaction not found on blockchain"
- Wait a few seconds and retry
- Verify transaction hash is correct
- Check if transaction is confirmed on block explorer

### "Incorrect amount"
- User sent wrong amount
- Check network decimal places (BSC = 18!)
- Amount must match ±1%

### "Incorrect recipient address"
- User sent to wrong address
- User used wrong network
- Contact support for refund

### "Authentication failed"
- JWT token expired
- Re-login user
- Refresh token if available

---

## ?? Support

### For Backend Issues
- Check API logs
- Review Hangfire dashboard: https://api.wihngo.com/hangfire
- Contact backend team

### For Frontend Issues
- Review this documentation
- Check React Native documentation
- Test with Postman collection first
- Open GitHub issue

---

## ?? Useful Links

- **API Documentation**: See files in this folder
- **Tron Explorer**: https://tronscan.org
- **Ethereum Explorer**: https://etherscan.io
- **BSC Explorer**: https://bscscan.com
- **React Native QR Code**: https://github.com/awesomejerry/react-native-qrcode-svg
- **Expo Clipboard**: https://docs.expo.dev/versions/latest/sdk/clipboard/

---

## ?? Notes

- Minimum payment: **$5 USD**
- Payment expiration: **30 minutes**
- Polling interval: **5 seconds** (recommended)
- Authentication: **JWT Bearer token** (all authenticated endpoints)
- Networks: **Tron, Ethereum, BSC** (USDT)
- BSC uses **18 decimals** (not 6!)

---

## ?? Next Steps

1. **Import Postman collection** and test API
2. **Copy TypeScript types** to your project
3. **Read the quick start guide**
4. **Implement payment screen** using examples
5. **Test with small amounts** first
6. **Add error handling** for all edge cases
7. **Submit for code review**

---

**Last Updated**: January 2024  
**Backend API Version**: 1.0  
**Framework**: .NET 10 / ASP.NET Core  
**Frontend**: Expo React Native

**Made with ?? for Wihngo**
